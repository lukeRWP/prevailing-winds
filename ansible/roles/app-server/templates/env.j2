# ============================================================
# IMP Configuration — Generated by Ansible ({{ env_name }})
# Generated: {{ ansible_date_time.iso8601 }}
# Do not edit manually — re-deploy to update.
# ============================================================

# --- Core ---
NODE_ENV={{ app_server_node_env | default('production') }}
APP_NAME=imp
PORT={{ app_server_port | default(2727) }}
CLIENT_URL=https://{{ nginx_server_name }}

# --- Database ---
MYSQL_URL={{ hostvars[groups['imp_databases'][0]].ansible_host }}
MYSQL_USER={{ vault_mysql_user }}
MYSQL_PASSWORD={{ vault_mysql_password }}
MYSQL_USE_SSL={{ mysql_require_ssl | default(true) | lower }}
MYSQL_SSL_USER={{ vault_mysql_ssl_user }}
MYSQL_SSL_PASSWORD={{ vault_mysql_ssl_password }}
MYSQL_SSL_PATH={{ app_server_shared_dir }}/mysql-ssl

# --- Database Names ---
MAIN_DATABASE=IMP_PROJECTS
PROJECT_DB=IMP_PROJECTS
PROGRAM_DB=IMP_PROGRAMS
LOCATION_DB=IMP_LOCATIONS
USER_DB=IMP_USERS
MILESTONE_DB=IMP_MILESTONES
CAPITAL_DB=IMP_CAPITAL
ADMIN_DB=IMP_ADMIN
REPORTING_DB=IMP_REPORTING
ANALYTICS_DB=IMP_ANALYTICS
IMPORT_DB=IMP_IMPORTS
EXPORT_DB=IMP_EXPORTS
FILES_DB=IMP_FILES
NOTES_DB=IMP_NOTES

# --- File Storage (MinIO) ---
S3_BUCKET=imp-files
S3_REGION=us-east-1
S3_ACCESS_KEY={{ vault_s3_access_key }}
S3_SECRET_KEY={{ vault_s3_secret_key }}
S3_ENDPOINT=https://{{ hostvars[groups['imp_storage'][0]].ansible_host }}:9000
S3_PUBLIC_ENDPOINT=https://minio.{{ env_name }}.razorwire-productions.com:9000

# --- TLS Trust ---
NODE_EXTRA_CA_CERTS={{ app_server_shared_dir }}/minio-ca.crt

# --- Security ---
AUTH_SECRET_ENCRYPTION_KEY={{ vault_auth_secret_key }}
COOKIE_SECRET={{ vault_cookie_secret }}
BYPASS_AUTH=false
FILE_ENCRYPTION_ENABLED=false
FILE_ENCRYPTION_MASTER_KEY={{ vault_file_encryption_key }}
FILE_ENCRYPTION_KEY_VERSION=1
SYNC_ENCRYPTION_KEY={{ vault_sync_encryption_key }}
ENCRYPT_STORAGE_KEYS=false

# --- Logging ---
LOG_LEVEL={{ 'debug' if env_name == 'dev' else 'info' }}
LOG_TO_DATABASE=true
LOG_TO_FILE=true
LOG_TO_CONSOLE=true
SERVER_ID=imp-api-{{ env_name }}
SERVICE_NAME=imp-api

# --- Sync ---
SYNC_ADMIN_DB=IMP_ADMIN
SYNC_TARGETS_TABLE=SYNC_TARGETS
SYNC_ATTEMPTS_TABLE=SYNC_ATTEMPTS
SYNC_CACHE_TTL=300000
SYNC_MAX_RETRIES=3

# --- Integrations ---
BQ_PROJECT_ID=
BQ_DATASET=EXPANSIONS_PLANNING
SLACK_WEBHOOK_URL=
