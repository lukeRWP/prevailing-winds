---
# Seed admin user, roles, permissions, and storage provider.
# Runs on the app server (requires database connectivity).
#
# Usage:
#   task deploy:seed-admin ENV=dev
#   ansible-playbook playbooks/seed-admin.yml -i inventories/dev/hosts.yml --vault-password-file ~/.ansible-vault-pass --become

- name: Seed admin data
  hosts: imp_servers
  become: yes
  become_user: "{{ deploy_user | default('deploy') }}"
  gather_facts: no
  tasks:
    - name: Run seed-admin script
      command: node scripts/seed-admin.js
      args:
        chdir: "{{ app_server_current_link | default('/opt/imp-server/current') }}"
      register: seed_result
      changed_when: "'new record' in seed_result.stdout"

    - name: Show seed output
      debug:
        msg: "{{ seed_result.stdout_lines }}"
